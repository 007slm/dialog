define("arale/dialog/1.0.0/dialog",["$","arale/overlay/0.9.13/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.0/iframe-shim","arale/widget/1.0.2/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/overlay/0.9.13/mask","arale/widget/1.0.2/templatable","gallery/handlebars/1.0.0/handlebars"],function(a,b,c){function l(a){null==a.attr("tabindex")&&a.attr("tabindex","-1")}function m(a){var b=a[0].contentWindow.document;return b.body.scrollHeight&&b.documentElement.scrollHeight?Math.min(b.body.scrollHeight,b.documentElement.scrollHeight):b.documentElement.scrollHeight?b.documentElement.scrollHeight:b.body.scrollHeight?b.body.scrollHeight:void 0}var d=a("$"),e=a("arale/overlay/0.9.13/overlay"),f=a("arale/overlay/0.9.13/mask"),g=a("arale/events/1.0.0/events"),h=a("arale/widget/1.0.2/templatable"),i=".dialog",j="300px";seajs.importStyle(".ui-dialog,.ui-dialog-close{position:absolute;top:0}.ui-dialog{z-index:999;left:50%;top:50%;width:500px;background-color:rgba(0,0,0,.5);border:0;FILTER:progid:DXImageTransform.Microsoft.Gradient(startColorstr=#88000000, endColorstr=#88000000);padding:6px}:root .ui-dialog{FILTER:none9}.ui-dialog-close{display:block;right:16px;top:16px;z-index:10;cursor:pointer}.ui-dialog-content{background:#fff;height:100%;*zoom:1}.ui-dialog-x{color:#999;font-family:tahoma;font-size:24px;line-height:14px;height:18px;width:18px;text-decoration:none;display:block;overflow:hidden;cursor:pointer;font-weight:700}.ui-dialog-x:hover{color:#666;text-shadow:0 0 2px #aaa}","arale/dialog/1.0.0/dialog.css");var k=e.extend({Implements:h,attrs:{template:'<div class="{{classPrefix}}">\n<div class="{{classPrefix}}-close" title="关闭本框" data-role="close"></div>\n<div class="{{classPrefix}}-content"  data-role="content">\n</div>\n</div>',trigger:{value:null,getter:function(a){return d(a)}},classPrefix:"ui-dialog",content:{value:"",setter:function(a){return/^(https?:\/\/|\/|\.\/|\.\.\/)/.test(a)&&(this._type="iframe"),a}},hasMask:!0,closeTpl:'<a href="#" class="ui-dialog-x">×</a>',width:500,height:null,effect:"none",zIndex:999,autoFit:!0,align:{selfXY:["50%","50%"],baseXY:["50%","50%"]}},parseElement:function(){this.model={classPrefix:this.get("classPrefix")},k.superclass.parseElement.call(this),this.contentElement=this.$("[data-role=content]")},events:{"click [data-role=close]":function(a){a.preventDefault(),this.hide()}},show:function(){return"iframe"===this._type&&(this.element.css("height",j),this._showIframe()),k.superclass.show.call(this),this},hide:function(){return"iframe"===this._type&&this.iframe&&(this.iframe[0].onload=null,this.iframe.attr({src:"javascript:'';"})),this.trigger("close"),k.superclass.hide.call(this),this},destroy:function(){return this.get("trigger").off("click"+i+this.cid),this.element.remove(),f.hide(),clearInterval(this._interval),k.superclass.destroy.call(this)},setup:function(){k.superclass.setup.call(this),this._setupTrigger(),this._setupMask(),this._setupKeyEvents(),this._setupFocus(),l(this.element),l(this.get("trigger")),this.activeTrigger=this.get("trigger").eq(0)},_onRenderContent:function(a){if("iframe"!==this._type){var b;try{b=d(a)}catch(c){b=[]}b[0]?this.contentElement.empty().append(b):this.contentElement.empty().html(a)}},_onRenderCloseTpl:function(a){a=a.replace("ui-dialog",this.get("classPrefix")),this.$("[data-role=close]").html(a)},_onRenderVisible:function(a){a?"fade"===this.get("effect")?this.element.fadeIn(200):this.element.show():this.element.hide()},_setupTrigger:function(){var a=this;this.get("trigger").on("click"+i+this.cid,function(b){b.preventDefault(),a.activeTrigger=d(this),a.show()})},_setupMask:function(){this.before("show",function(){this.get("hasMask")&&f.show()}),this.before("hide",function(){this.get("hasMask")&&f.hide()})},_setupFocus:function(){this.after("show",function(){this.element.focus()}),this.after("hide",function(){this.activeTrigger&&this.activeTrigger.focus()})},_setupKeyEvents:function(){this.delegateEvents("keyup",function(a){27===a.keyCode&&this.hide()})},_showIframe:function(){var a=this;this.iframe||this._createIframe(),this.iframe.attr({src:this.get("content"),name:"dialog-iframe"+(new Date).getTime()}),this.iframe[0].onload=function(){a.get("autoFit")&&(clearInterval(a._interval),a._interval=setInterval(function(){a._syncHeight()},500)),a._syncHeight(),a._setPosition(),a.iframe[0].onload=null,a.trigger("complete:show")}},_createIframe:function(){var a=this;"iframe"===this._type&&(this.iframe=d("<iframe>",{src:"javascript:'';",scrolling:"no",frameborder:"no",allowTransparency:"true",css:{border:"none",width:"100%",height:"100%"}}).appendTo(this.contentElement),g.mixTo(this.iframe[0]),this.iframe[0].on("close",function(){a.hide()}))},_syncHeight:function(){var a;if(this.get("height"))clearInterval(this._interval);else{try{a=m(this.iframe)+"px"}catch(b){a=j,clearInterval(this._interval)}this.element.css("height",a)}}});c.exports=k});